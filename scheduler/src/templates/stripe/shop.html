<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Kiwix Shop</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel='stylesheet' id='et-builder-googlefonts-cached-css'  href='https://fonts.googleapis.com/css?family=Quicksand:300,regular,500,600,700&#038;subset=latin,latin-ext&#038;display=swap' type='text/css' media='all' />
    <script src="https://polyfill.io/v3/polyfill.min.js?version=3.52.1&features=fetch,formdata"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <style type="text/css">
.container {
  position: relative;
}
.loader { display: none; color: #ff9933; }

.table-offer { font-family: 'Quicksand',Helvetica,Arial,Lucida,sans-serif; }

.offer {
  /*display: table-cell;*/
  border: 1px solid #bebebe;
  background-color: #fcfcfc;

  width: 100%;
  max-width: 100%;
  position: relative;

  -webkit-box-flex: 1;
  flex: 1 1 auto;
}

.offer:last-child { border: 1px solid #bebebe; }
.offer:hover { background-color:rgba(0,0,0,.05) }

.offer.splitter {
  display: none;
  height: 0;
  width: 0;
}

/* display 2 rows of 2 blocks */
@media (min-width:767px) {
  .offer {
    border-right: 0;
    display: table-cell;
    width: 45%;
    max-width: 45%;
  }
  .offer:nth-child(2) {
    border: 1px solid #bebebe;
  }
  .offer.splitter {
    display: block;
  }
}
@media (min-width:1080px) {
  .offer {
    display: table-cell;
    width: 25%;
    max-width: 25%;
  }
  .offer:nth-child(2) {
    border-right: 0;
  }
  .offer.splitter {
    display: none;
  }
}

/* make sure splitter is never shown */
.offer.splitter {
  height: 0;
  width: 0;
}

.offer header {
  background-color: #bebebe;
  padding: 10px 0;
  color: #fff;
  text-align: center;
}
.offer header h2 {
  font-size: 150% !important;
  padding-top: 0.5em;
  padding-bottom: 5px;
  font-weight: 900;
  line-height: 1.7em;
}
.offer header p {
  font-size: 18px;
  line-height: 20px;
  font-weight: 500;
}

.offer .price {
  text-align: center;
  color: #999;
  font-size: 16px;
  padding-top: 17px;
  padding-bottom: 30px;
  position: relative;
  border-bottom: 1px #bebebe;
  border-bottom-style: solid;
}
.offer .price .amount {
  color: #ff9933;
  font-size: 80px;
  line-height: 1.03em;
  font-weight: 300;
}

.offer .description {
  padding: 30px;
  text-align: left;
  padding-bottom: 60px;
}
.offer .description ul {
  list-style: none !important;
  padding: 0 !important;
  line-height: inherit !important;
}
.offer .description ul li {
  color: #666;
  line-height: 1.7em;
  font-weight: 500;
  line-height: 1.6em;
  padding: 0 0 1.6em 14px;
}
.offer .description ul li::before {
  content: "• ";
  color: #2ea3f2;
}


.download-btn { display: inline-block; }
@media (max-width:380px) {
  .offer .description { padding-bottom: 120px; }
  /*.download-btn:first-child { margin-bottom: .5em; }*/
}
@media (min-width:1080px) and (max-width: 1400px) {
  /*.download-btn:first-child { margin-bottom: .5em; }*/
}

.offer .button-holder {
  text-align: center;
  margin-bottom: 2em;

  position: absolute;
  bottom: 0px;
  left: 0;
  right: 0;
  margin-left: auto;
  margin-right: auto;
}

.offer .button-holder button,
.offer .button-holder a {
  color: #ff9933;
  font-size: 20px;
  font-weight: 500;
  padding: .3em 1em;
  line-height: 1.7em !important;
  border: 2px solid;
  border-radius: 3px;
  -webkit-transition: all .2s;
  transition: all .2s;
}
.offer .button-holder button:hover,
.offer .button-holder a:hover {
  padding: .3em 1.5em; border-color: transparent; }
.offer .button-holder button:after,
.offer .button-holder button:before,
.offer .button-holder a:after,
.offer .button-holder a:before {
  content:"";
  opacity:0;
  position:absolute;
  -webkit-transition:all .2s;
  transition:all .2s;

  border: solid #ff9933;
  border-width: 0 3px 3px 0;
  display: inline-block;
  padding: 6px;
  transform: rotate(-45deg);
  -webkit-transform: rotate(-45deg);
  margin-left: 3px;
  margin-top: 10px;
}
.offer .button-holder button:hover:after,
.offer .button-holder a:hover:after {
 -webkit-transition:none!important; transition:none!important }
.offer .button-holder button:before,
.offer .button-holder a:before {
  display:none }
.offer .button-holder button:hover:after,
.offer .button-holder a:hover:after {
  opacity:1; margin-left:0; }
    </style>
  </head>
  <script type="text/javascript">
function send_height_to_parent(){
  try {
    var actual_height = document.querySelector('body').scrollHeight;
    console.debug(parent.postMessage(JSON.stringify({height: actual_height}), "*"));
  } catch (e) {
    console.error("Unable to send height to parent…", e.toString());
  }
}
function onframeresize(e) {
  send_height_to_parent();
}
window.onresize = onframeresize;
</script>
  <body onload="send_height_to_parent();">
    <section class="no-container">

      <div class="table-offer">
        <div class="offer">
          <header>
            <h2>Demo</h2>
            <p>Try before you buy</p>
          </header>
          <section class="price"><span class="amount">Free</span></section>
          <section class="description">
            <ul>
              <li>A selection of Wikipedia’s 50,000 most demanded articles.</li>
              <li>Includes complete Raspberry Pi StackExchange archive</li>
              <li>Fits on a 8GB microSD card</li>
            </ul>
            <form class="text-center button-holder">
              <a class="btn btn-outline-secondary download-btn" href="{{ api_url }}/auto-images/demo/redirect/http">Download</a>
              <a class="btn btn-outline-secondary download-btn" href="{{ api_url }}/auto-images/demo/redirect/torrent">via torrent</a>
            </form>
          </section>
        </div>

        <div class="offer">
          <header>
            <h2>Wikipedia</h2>
            <p>All of Wikipedia, ready to go</p>
          </header>
          <section class="price"><span class="amount">$15</span></section>
          <section class="description">
            <ul>
              <li>The entirety of Wikipedia (6.7 million articles, including images)</li>
              <li><strong>Plus</strong> the Wiktionary (7.9 million entries in 4,200 languages)</li>
              <li><strong>Plus</strong> the complete Raspberry Pi StackExchange archive</li>
              <li>Fits on a 200 GB microSD card</li>
            </ul>
          </section>
          <form class="button-holder">
            <input type="hidden" name="product" value="wikipedia-{{ lang }}">
            <button class="btn btn-outline-secondary">Purchase</button>
            <div class="loader"><i class="spinner-border spinner-border-xl" role="status"></i></div>
          </form>
        </div>

        <div class="offer splitter"></div>

        <div class="offer">
          <header>
            <h2>Preppers</h2>
            <p>For all your SHTF needs</p>
          </header>
          <section class="price"><span class="amount">$25</span></section>
          <section class="description">
            <ul>
              <li>Dozens of resources on homesteading, water treatment, military and emergency medicine, <em>etc.</em></li>
              <li>WikiHow, iFixit, and other repair resources</li>
              <li>The entire Wikipedia</li>
              <li>TrailSense and Survival apps for Android, ready to download</li>
              <li>Fits on a 256 GB microSD card</li>
            </ul>
          </section>
          <form class="button-holder">
            <input type="hidden" name="product" value="preppers">
            <button class="btn btn-outline-secondary">Purchase</button>
            <div class="loader"><i class="spinner-border spinner-border-xl" role="status"></i></div>
          </form>
        </div>

        <div class="offer">
          <header>
            <h2>Build your own</h2>
            <p>Access the full library</p>
          </header>
          <section class="price"><span class="amount">$29</span></section>
          <section class="description">
            <ul>
              <li><strong>Full imager access for a whole month</strong></li>
              <li>Choose from thousands of websites and apps, and build your own Offspot with Wikipedia, TED videos, the Gutenberg library, StackExchange / StackOverflow, and more!</li>
              <li>Create multiple configurations with the content you and your community need.</li>
              <li>Customize your network’s name and appearance</li>
              <li>Up to 1 TB on a single microSD card</li>
            </ul>
          </section>
          <form class="button-holder">
            <input type="hidden" name="product" value="access-1m">
            <button class="btn btn-outline-secondary">Purchase</button>
            <div class="loader"><i class="spinner-border spinner-border-xl" role="status"></i></div>
          </form>
        </div>

      </div>
    </section>
  </body>
  <script type="text/javascript">
    // Stripe public API key
    var stripe = Stripe("{{ stripe_public_key }}");

    var forms = document.getElementsByTagName("form");
    for(var i = forms.length; i--; ) {
      forms[i].addEventListener("submit", function (e) {
        e.preventDefault();

        // display loader
        e.target.querySelector(".loader").style.display = "block";
        // hide button
        var button = e.target.querySelector("button");
        button.disabled = "disabled";
        button.style.display = "none";

        var form = new FormData(e.target);
        fetch("{{ api_url }}/shop/stripe/create-session", {
          method: "POST",
          body: form,
        })
        .then(function (response) {
          if (response.status != 200) {
            console.error(response);
            throw("HTTP Error " + response.status);
          }
          return response.json();
        })
        .then(function (session) {
          if (session.error) {
            throw(session.error);
          }
          // success ; redirect whole window to stripe
          return stripe.redirectToCheckout({ sessionId: session.id });
        })
        .then(function (result) { // error, restore button
          // hide loader
          e.target.querySelector(".loader").style.display = "none";
          // hide button
          var button = e.target.querySelector("button");
          button.disabled = "";
          button.style.display = "inline-block";

          // should redirectToCheckout fails due to a browser or network error
          if (result.error) {
            alert(result.error.message);
          }
        })
        .catch(function (error) {
          console.error("Error:", error);
          // js error ; restore button
          // hide loader
          e.target.querySelector(".loader").style.display = "none";
          // hide button
          var button = e.target.querySelector("button");
          button.disabled = "";
          button.style.display = "inline-block";
          alert("An error occured: " + error);
        });
      });
    }
  </script>
</html>
